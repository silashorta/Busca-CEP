<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Busca CEP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
    <style>
        body { 
            background-color: #e2e2e2;
        }
        main {
            background-color: #ffffff;
        }
        #cabecalho{
            background-color: rgb(254, 255, 174);
        }
        #mensagemErro{
            display: none;
            margin: 0;
            padding: 0.5em;
        }

    </style>
  </head>
  <body class="p-md-5">
    <main class="container-fluid border">
            <div id="cabecalho" class="d-flex flex-wrap justify-content-around align-items-center mt-3">
                <img src="busca_cep.png" alt="" width="750px" class="img-fluid">
                <div><img src="Messenger-pana.svg" class="img-fluid" width="300px"></div>
            </div>
                <form class="pb-3">

                    <div id="divErro">
                        <label for="cep" class="form-check-label mt-2">CEP</label>
                        <input type="text" name="cep" id="cep" placeholder="apenas números." class="form-control" maxlength="8">
                    </div>
                    <div id="mensagemErro" class="alert alert-danger" role="alert"></div>

                    <label for="rua" class="form-check-label mt-3">Rua</label>
                    <input type="text" name="rua" id="logradouro" class="form-control">

                    <label for="rua" class="form-check-label mt-3">Complemento</label>
                    <input type="text" name="complemento" id="complemento" class="form-control">

                    <label for="bairro" class="form-check-label mt-3">Bairro</label>
                    <input type="text" name="bairro" id="bairro" class="form-control">

                    <label for="cidade" class="form-check-label mt-3">Cidade</label>
                    <input type="text" name="cidade" id="localidade" class="form-control">

                    <label for="estado" class="form-check-label mt-3">Estado</label>
                    <input type="text" name="estado" id="uf" class="form-control">

                    <button type="" id="botaoBuscar" class="btn btn-primary mt-3">Pesquisar</button>
                    <button type="" id="botaoLimpar" class="btn btn-outline-danger mt-3 mx-3">Limpar</button>
                    <button type="" id="botaoCopiar" class="btn btn-outline-primary mt-3">Copiar</button>
                </form>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    <script>
        const mensagemErro = document.querySelector("#mensagemErro");
        const cepbusca = document.querySelector("#cep");
        const logradouro = document.querySelector("#logradouro");
        const complemento = document.querySelector("#complemento");
        const bairro = document.querySelector("#bairro");
        const localidade = document.querySelector("#localidade");
        const uf = document.querySelector("#uf");
        const btnBuscar =  document.querySelector("#botaoBuscar");
        const btnLimpar =  document.querySelector("#botaoLimpar");
        const btnCopiar = document.querySelector("#botaoCopiar");
        const divErro =  document.querySelector("#divErro");
        let endereco; 

        btnBuscar.addEventListener('click', (e) => {
            e.preventDefault(); 
            try{
                validaCEP();
            }catch(erro){
                mensagemErro.innerHTML = erro.message;
                logradouro.value = "";
                complemento.value = "";
                bairro.value = "";
                localidade.value = "";
                uf.value = "";
            }
        })

        btnLimpar.addEventListener('click', () => {
            limpaCampos();
        })

        btnCopiar.addEventListener('click', (e) => {
            e.preventDefault();
            copiaTexto();
        })

        function limpaCampos(){
            cepbusca.value = "";
            logradouro.value = "";
            complemento.value = "";
            bairro.value = "";
            localidade.value = "";
            uf.value = "";
            mensagemErro.innerHTML = "";
        }

        function copiaTexto() {
        let textoCopiado = `${logradouro.value}, ${complemento.value}, ${bairro.value}, ${localidade.value}/${uf.value}`;
        navigator.clipboard.writeText(textoCopiado);
        //navigator.clipboard.write(textoCopiado);

        //textoCopiado.select();
        document.execCommand("copy");

        if (logradouro.value === "") {
            console.log(logradouro.value);
            alert(`Não há um endereço válido a ser copiado.`)
        }else{
            alert(`O endereço ${textoCopiado} foi copiado com sucesso!`);
            }
        }

        function validaCEP(){
            const regex = /^[0-9]{8}$/;
            if (regex.test(cepbusca.value)){
                buscaEndereco();
                mensagemErro.style.display = 'none';
            }else{
                mensagemErro.style.display = 'block';
                mensagemErro.classList.add("alert-danger")
                throw new Error("O CEP informado é inválido!");
            }
        }

        function buscaEndereco(){
            fetch(`https://viacep.com.br/ws/${cepbusca.value}/json`)
            .then((resposta) =>{
                return resposta.json();
            })
            .then((endereco) =>{
                preencheCampos(endereco);

                console.log(endereco);

                if(endereco.logradouro === undefined){
                    mensagemErro.style.display = 'block';
                    mensagemErro.classList.replace("alert-danger", "alert-warning");
                    mensagemErro.innerHTML = "O CEP informado não existe.";
                    logradouro.value = "";
                    complemento.value = "";
                    bairro.value = "";
                    localidade.value = "";
                    uf.value = "";
                }
                
            })
            .catch((erro)=>{
                console.error(erro);
            })
        }

        function preencheCampos(endereco){
            logradouro.value = endereco.logradouro;
            complemento.value = endereco.complemento;
            bairro.value = endereco.bairro;
            localidade.value = endereco.localidade;
            uf.value = endereco.uf;
        }
    </script>
  </body>
</html>